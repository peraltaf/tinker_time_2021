{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{ SITE_NAME }}</title>

    <link rel="shortcut icon" href="{% static 'images/favicon.png' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/Glyphter.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'css/webdatarocks.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery.dataTables.min.css' %}">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.5.6/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">

    {% block additional_css %}{% endblock %}

    <link rel="stylesheet" href="{% static 'css/jquery-confirm.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-multiselect.css' %}">
    <link rel="stylesheet" href="{% static 'css/hopscotch.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-datetimepicker.min.css' %}" />

    {% if user.profile.theme == 'dark' %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/theme/dark/webdatarocks.css' %}" />
    <link rel="stylesheet" href="http://{{ ENV }}/static/css/default_dark.css">
    {% else %}
    <link rel="stylesheet" href="{% static 'css/webdatarocks.min.css' %}">
    <!-- <link rel="stylesheet" href="http://{{ ENV }}/static/css/default.css"> -->
    <link rel="stylesheet" href="{% static 'css/default.css' %}">
    {% endif %}

    <style>
      .login { height: 100%; }
    </style>

    <script type="text/javascript">
      let user = '{{ user.username }}';
      let session_id = '{{ session_id }}';

      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({
          'user_id': user,
          'session_id': session_id
      });
    </script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NLTRH37');</script>
    <!-- End Google Tag Manager -->
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NLTRH37"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

      <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 border-bottom shadow-sm main-nav">
        {% if user.profile.theme == 'dark' %}
        <img src="{% static '/images/logo_dark.svg' %}" width="30" height="30" class="d-inline-block align-top" alt="">
        {% else %}
        <img src="{% static '/images/logo_light.svg' %}" width="30" height="30" class="d-inline-block align-top" alt="">
        {% endif %}
        <h5 class="my-0 mr-md-auto font-weight-normal"><a href="/">{% block site_nm %}{{ SITE_NAME }}{% endblock %}</a></h5>
       
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="/">Sales Hub</a>
          </li>
          {% autoescape off %}
          {{ NAV_MENU }}
          {% endautoescape %}
        </ul>

        <ul class="nav">
          <li class="nav-item">
            <i class="fas fa-user"></i>&nbsp;&nbsp;{{ user.username }}
          </li>
        </ul>

        <!-- <div class="dropdown profile-dropdown">
          <button class="btn dropdown-toggle" type="button" id="profile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user"></i>&nbsp;&nbsp;{{ user.username }}
          </button>
          <div class="dropdown-menu" aria-labelledby="profile-dropdownofile">
            <a class="dropdown-item" href="/profile">Update Profile</a>
          </div>
        </div> -->
        <div class="nav-spacer"></div>
        <i id="view-tour" class="fas fa-taxi {% if request.path == '/profile/' %}disabled{% endif %}"></i>
      </div>

      <div class="container-fluid main-container">
        <input type="hidden" id="csrf-token" value="{{ csrf_token }}" >
        {% block layout %}{% endblock %}
      </div>

      <footer></footer>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/no-data-to-display.js"></script>
    <script src="{% static 'scripts/jquery.dataTables.min.js' %}"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js"></script>
    <script src="{% static 'scripts/jquery-confirm.min.js' %}"></script>
    <script src="{% static 'scripts/moment.min.js' %}"></script>
    <script src="{% static 'scripts/moment-timezone-with-data.min.js' %}"></script>
    <script src="{% static 'scripts/bootstrap-multiselect.js' %}"></script>
    
    <script src="{% static 'scripts/hopscotch.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="{% static 'scripts/dom-to-image.min.js' %}"></script>
    <script src="{% static 'scripts/alasql.js' %}"></script>
    <script src="{% static 'scripts/papaparse.js' %}"></script>
    <script src="{% static 'scripts/axios.min.js' %}"></script>
    <script src="{% static 'scripts/d3.v5.min.js' %}"></script>
    <script src="{% static 'scripts/default_chart_options.js' %}"></script>
    <script src="{% static 'scripts/exporting.js' %}"></script>
    <script src="http://{{ ENV }}/static/scripts/footer.js"></script>

    {% block date_scripts %}
    <script src="{% static 'scripts/bootstrap-datetimepicker.min.js' %}"></script>
    {% endblock %}

    <script type="text/javascript">
      const charts = {};
      window.filters = {};
      /*** Panel Controls ***/
      $('.close-link').on('click', function() {
        let this_text = $(this).parent().parent().text().trim();
        $(this).parent().parent().parent().remove();

        $.each($('.nav-link'), function(i,d) {
          let target_link = $(this).text().trim();
          if (target_link === this_text) $(this).parent().remove();
        })
      });

      $('.collapse-link').on('click', function() {
        $current = $(this);
        if ($current.children('i').hasClass('fa-chevron-up')) { console.log('test')
          $current.children('i').addClass('fa-chevron-down').removeClass('fa-chevron-up');
          $current.parent().parent().parent().children('.panel-content').css('display', 'none');
        } else {
          $current.children('i').removeClass('fa-chevron-down').addClass('fa-chevron-up');
          $current.parent().parent().parent().children('div.panel-content').css('display', 'block');
        }
      });

      $('.scroll-top').on('click', function() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
      });
      /*** End Panel Controls ***/

      const alert_msg = (msg,title='Error',color='red',redir=undefined) => {
        let alert_conf = {
          title: title,
          content: msg,
          closeIcon: true,
          type: color
        }

        if (redir !== undefined) {
          alert_conf.buttons = {
            ok: function () {
              window.location.href = redir;
            }
          }
        }

        return $.alert(alert_conf);
      }

      $('footer').html(footer);
    </script>
    {% block additional_scripts %}{% endblock %}
  </body>
</html>
